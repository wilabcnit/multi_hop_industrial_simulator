# multi_hop_industrial_simulator
This is a discrete-time network simulator, written in Python, that models a THz wireless network for an Industrial Internet of Things (IIoT) scenario in the context of the TIMES project. 
It is designed to evaluate the performance of multi-hop communication in a factory-like scenario, with a focus on success probability, average latency, network throughput and jain index. 
To enable multi-hop efficiently, three different routing algorithms have been implemented: 

1. Table-Based (TB) - it is the proposed solution, where route discovery and maintenance are performed through user-plane data exhchanges only. TB is also extended with a Multi-Agent Deep Reinforcement Learning (MADRL) algorithm to autonomously adapt several Medium Access Control (MAC) parameters;
2. Table-Less (TL) - it is a broadcast-based protocol that forwards all received data without maintaining routing tables;
3. Ad hoc On-Demand Distance Vector (AODV) - it relies on control messages for neighbor and route discovery.

All routing algorithms operate on top of an unslotted Aloha MAC protocol, while for the wireless propagation, the simulator can use either an experimentally derived channel model, or  the 3GPP indoor factory channel model from TR 38.901.  

The simulation environment models an industrial scenario with the following characteristics:
- Base station (BS): A BS is deployed at the center of the area, serving as the anchor point for communication.
- User Equipment (UE) deployment:
    - UEs are placed over a regular grid layout to ensure that all of them can reach the BS through one or more hops. Note that, if the input parameters (e.g., UE transmit power, UE antenna gain etc.) are changed, it is necessary to modify their coordinates within the environment to ensure that they can reach the BS;
    - UEs can also be randomly and uniformly distributed in the environment, with the requirement that each has at least one neighbor if direct BS connectivity is not possible.
- Obstacles: Fixed-position obstacles are included, which block some links and create Line-of-Sight (LOS) or Non-Line-of-Sight (NLOS) conditions.
- Full-buffer traffic model:
    - Each UE always has data to send.
    - As soon as a DATA packet is successfully delivered (or discarded after exceeding the maximum number of retransmission attempts), a new packet is immediately generated.  
These assumptions ensure that the network operates under saturated traffic conditions, highlighting the impact of routing strategies and channel impairments on performance.

Repository Structure:

- env - Deployment of the reference scenario:
  - Creates the industrial layout (parallelepiped);
  - Positions UEs, BS, and machines (obstacles) at predefined locations and according to the selected distribution type.
- Network - Defines UEs and BS:
  - Initialization of entities;
  - Methods for interaction and simulation execution.
- Traffic_models
- Channel_models:
  - Path loss computation;
  - Received power calculation;
  - Absorption effects evaluation.
- Utils - Utility functions:
  - Interference and collision check at the receiver;
  - LOS/NLOS condition evaluation;
  - Next-action logic for the RL-based algorithm;
  - Instantiation of UEs and BS.
- Test: main files for routing strategies:
  - TB;
  - TL;
  - AODV;
  - TB with MADRL.
- Results: Folder for storing simulation outputs.

Input File Description:

The simulator requires an input file in YAML format, which specifies all the parameters for the simulation. The main sections are described below:
- Traffic Configuration:
    - Define the type of traffic generated by the UEs (User Equipments);
    - For each traffic type, a percentage of UEs must be specified;
    - In our work, we mainly focus on the full queue traffic type (the fourth option in the file). However, three other traffic types are available, each with different characteristics.
- Radio Parameters:
    - Set carrier frequency, channel bandwidth, bit rate, and modulation order;
    - Pay attention to the units of measurement when specifying values.
- Channel Parameters:
    - Channel parameters can be customized;
    - Define the channel model:
        - use_huawei_measurements: True → experimental channel model
        - use_huawei_measurements: False → 3GPP factory model
    - Molecular absorption coefficients are provided in a separate file but are not used by default.
- UE Configuration:
    - Choose deployment type: "Grid" or "Uniform".
    - For "Grid", positions are read from input_scenario_grid.xlsx. To change placement, modify this file and re-distribute UEs to ensure connectivity.
    - Set UE-related parameters (antenna gain, number of antennas, transmit power and noise figure).
- Base Station (BS) Configuration:
    - Define all BS-related parameters (antenna gain, number of antennas, transmit power and noise figure).
- Scenario Setup:
    - By default, the "grid" scenario is used, with machines placed in fixed, precise positions. It is possible to create a new environment and define a different scenario.
- MAC Parameters:
    - Medium Access Control settings are configured in the aloha_protocol section of the YAML file.
- Power Consumption:
    - Set the power consumed (W) by UEs and the BS in the different MAC protocol states (e.g., transmit, receive, idle, backoff, wait_ack and propagation).
- Reinforcement Learning (RL) Parameters:
    - Router parameters: Time-To-Live (TTL), initial contention window size, and buffer size (optimized during training).
    - Agent parameters: learning rate and other RL-specific hyperparameters.
- High-Level Simulation Parameters:
    - Number of UEs (max 24 in grid mode);
    - Total simulation duration in seconds;
    - Number of simulations performed (to improve statistical reliability of results);
    - Star_topology: set to False to enable multi-hop communication;
    - Mobility options:
        - mobility_obstacle: true → obstacles (machines) move clockwise within the environment (step size = 2.25 or 4.5 m).
        - mobility_spawn: true → additional obstacles (Machines 9–11 in input_scenario_grid.xlsx) enter the grid, blocking/creating links.
        - mobility_shuffle: true → UEs “move” by exchanging their coordinates, repeated mobility_changes times.
        - If all mobility options are false, the scenario is static.

The main reference for the simulator is the paper: "MAC and Routing Protocols Design in Multi-Hop Terahertz Networks", S. Cavallero, A. Pumilia, G. Cuozzo, C. Buratti....

