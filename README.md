# multi_hop_industrial_simulator
This is a discrete-time network simulator, written in Python, that models a THz [^1] wireless network for an Industrial Internet of Things (IIoT) scenario in the context of the TIMES project (www.times6g.eu). 
It is designed to evaluate the performance of multi-hop communication in a factory-like scenario, with a focus on success probability, average latency, network throughput and jain index.

[^1]: Although developed for THz communications, the simulator can also be configured for other frequency bands through appropriate parameter tuning.

# Theoretical Background:

To enable multi-hop efficiently, three different routing algorithms have been implemented: 

1. Table-Based (TB) - it is the proposed solution, where route discovery and maintenance are performed through user-plane data exhchanges only. TB is also extended with a Multi-Agent Deep Reinforcement Learning (MADRL) algorithm to autonomously adapt several Medium Access Control (MAC) parameters;
2. Table-Less (TL) - it is a broadcast-based protocol that forwards all received data without maintaining routing tables (https://doi.org/10.1145/513800.513825);
3. Ad hoc On-Demand Distance Vector (AODV) - it is a reactive protocol that relies on control messages for neighbor and route discovery (https://doi.org/10.1145/581291.581300).

All routing algorithms operate on top of an unslotted Aloha MAC protocol, while for the wireless propagation, the simulator can use either an experimentally derived channel model, or  the 3GPP indoor factory channel model from TR 38.901 (https://www.3gpp.org/ftp/Specs/archive/38_series/38.901/).  

The simulation environment models an industrial scenario with the following characteristics:
- Base station (BS): A BS is deployed at the center of the area, serving as the anchor point for communication.
- User Equipment (UE) deployment:
    - UEs are placed over a regular grid layout to ensure that all of them can reach the BS through one or more hops. Note that, if the input parameters (e.g., UE transmit power, UE antenna gain etc.) are changed, it is necessary to modify their coordinates within the environment to ensure that they can reach the BS;
    - UEs can also be randomly and uniformly distributed in the environment, with the requirement that each has at least one neighbor if direct BS connectivity is not possible.
- Obstacles: Fixed-position obstacles are included, which block some links and create Line-of-Sight (LOS) or Non-Line-of-Sight (NLOS) conditions.
- Full-buffer traffic model:
    - Each UE always has data to send.
    - As soon as a DATA packet is successfully delivered (or discarded after exceeding the maximum number of retransmission attempts), a new packet is immediately generated.  
These assumptions ensure that the network operates under saturated traffic conditions, highlighting the impact of routing strategies and channel impairments on performance.

# Simulator Structure:

- env - Deployment of the reference scenario:
  - Creates the industrial layout (parallelepiped);
  - Positions UEs, BS, and machines (obstacles) at predefined locations and according to the selected distribution type.
- network - Defines UEs and BS:
  - Initialization of entities;
  - Methods for interaction and simulation execution.
- traffic_models:
  - Methods for setting the input traffic characteristics (periodicity, exponential distribution or full queue mode)
- channel_models:
  - Path loss computation;
  - Received power calculation;
  - Absorption effects evaluation.
- ddqn_agent:
    - TensorFlow/Keras implementations of Double DQN;
    - Model architectures, replay buffers, action-selection policies, and training routines for reinforcement learning with discrete actions.
- utils - Utility functions:
  - Interference and collision check at the receiver;
  - LOS/NLOS condition evaluation;
  - Next-action logic for the RL-based algorithm;
  - Instantiation of UEs and BS.
- test: main files for routing strategies:
  - TB;
  - TL;
  - AODV;
  - TB with MADRL.
- results: Folder for storing simulation outputs.

Input File Description:

The simulator requires an input file in YAML format, which specifies all the parameters for the simulation. The main sections are described below:
- Traffic Configuration:
    - Define the type of traffic generated by the UEs (User Equipments);
    - For each traffic type, a percentage of UEs must be specified;
    - In our work, we mainly focus on the full queue traffic type (the fourth option in the file). However, three other traffic types are available, each with different characteristics.
- Radio Parameters:
    - Set carrier frequency, channel bandwidth, bit rate, and modulation order;
    - Pay attention to the units of measurement when specifying values.
- Channel Parameters:
    - Channel parameters can be customized;
    - Define the channel model:
        - use_huawei_measurements: True → experimental channel model
        - use_huawei_measurements: False → 3GPP factory model
    - Molecular absorption coefficients are provided in a separate file but are not used by default.
- UE Configuration:
    - Choose deployment type: "Grid" or "Uniform".
    - For "Grid", positions are read from input_scenario.xlsx. To change placement, modify this file and re-distribute UEs to ensure connectivity.
    - Set UE-related parameters (antenna gain, number of antennas, transmit power and noise figure).
- Base Station (BS) Configuration:
    - Define all BS-related parameters (antenna gain, number of antennas, transmit power and noise figure).
- Scenario Setup:
    - By default, the "grid" scenario is used, with machines placed in fixed, precise positions. It is possible to create a new environment and define a different scenario.
- MAC Parameters:
    - Medium Access Control settings are configured in the aloha_protocol section of the YAML file.
- Power Consumption:
    - Set the power consumed (W) by UEs and the BS in the different MAC protocol states (e.g., transmit, receive, idle, backoff, wait_ack and propagation).
- Reinforcement Learning (RL) Parameters:
    - Router parameters: Time-To-Live (TTL), initial contention window size, and buffer size (optimized during training).
    - Agent parameters: learning rate and other RL-specific hyperparameters.
- High-Level Simulation Parameters:
    - Number of UEs (max 24 in grid mode);
    - Total simulation duration in seconds;
    - Number of simulations performed (to improve statistical reliability of results);
    - Star_topology: set to False to enable multi-hop communication;
    - Mobility options:
        - mobility_obstacle: True → obstacles (machines) move clockwise within the environment (step size = 2.25 or 4.5 m).
        - mobility_spawn: True → additional obstacles (Machines 9–11 in input_scenario.xlsx) enter the grid, blocking/creating links.
        - mobility_shuffle: True → UEs “move” by exchanging their coordinates, repeated mobility_changes times.
        - If all mobility options are False, the scenario is static.

# Simulator Working Principle:

In the Test files, the simulator maintains a hierarchical dictionary to track all packet receptions between UEs and the BS.
- Top-level keys: node IDs (UEs and BS).
- Second-level keys: type of reception event:
    - DATA_RX for data packets;
    - ACK_RX for acknowledgments;
    - RREQ_RX and RREP_RX for AODV routing messages.
- Third-level keys: IDs of peers from which packets were received.
- Values: a list containing reception details:
    - tick_start, tick_end: simulation ticks of reception;
    - packet_size: size of DATA packet (for DATA_RX);
    - dest_ue_id: destination UE ID for ACKs;
    - packet_id: ID of the DATA, or referenced DATA for ACK transmission.

Event-Driven Updates:

The simulator is discrete-time and event-driven. The reception structure is updated dynamically whenever a new event occurs. Fields may be inserted or removed. It operates as a state machine, with each state corresponding to a phase of routing algorithm and the Aloha protocol.
To improve efficiency, the simulator jumps to the next event instead of advancing one tick at a time when no events occur. This requires careful updating and verification of the reception structure at each time jump.

## Installation and Requirements:

This project has been developed and tested with **Python 3.9.18** and the following key packages:

- numpy==1.26.4
- pandas==2.2.3
- matplotlib==3.9.2
- scipy==1.13.1
- h5py==3.12.1
- pyyaml==6.0.2
- openpyxl==3.1.5
- tensorflow==2.10.0
- keras==2.10.0
- protobuf==3.20.3

Clone the repository and install the dependencies:

```bash
git clone https://github.com/<your-username>/<your-repo>.git (inserire nome finale)
cd <your-repo>
pip install <package_name>==<package_version>
```

## How to use it:
To verify the installation, you can run a simulation of **test_table-based.py** considering the full_queue traffic model for all the UEs.  

**Example Input Parameters:** The simulator is configured via the inputs.yaml.  
All parameters can be modified by the user to explore different scenarios and evaluate the impact on performance.  
For convenience, we provide in the repository a complete example input file with default values.  
Below is a **minimal excerpt** used for the quick test:
```yaml
traffic_fq:
    type: 4
    payload: 20  # [B]
    overhead_data: 10  # [B]
    percentage_of_ue: 100

simulation:
    tot_simulation_time_s: 0.0005
    n_simulations: 1
    initial_number_of_ues: 6
    final_number_of_ues: 6
    seed: 18
```
When the **test_table-based.py** runs successfully with the default values reported in inputs.yaml, you should obtain in output the following performance:
```
p_mac:  [0.9771614559121411]
S_net:  [2.10208]
Latency:  [6.135216367357746e-07]
Energy:  [2.4930431185849e-10]
Jain Index:  [0.9392188281856884]
Ticks in BO:  102.26491243666104
Ticks in TX_ACK:  2.001190948789202
Ticks in TX_DATA:  11.567389758179232
Ticks in WAIT_ACK:  85.28638748110608
Average Forced Broadcast Actions per Simulation:  3.6666666666666665
Average N forwarding per Simulation:  1075.0
Average number of interferers =  0.40626721855654885
```

To run more complex experiments, simply edit inputs.yaml and adjust the parameters of interest.

## Authors
Sara Cavallero, and Giampaolo Cuozzo are with the National Laboratory of Wireless Communications (WiLab), CNIT, Italy.
Andrea Pumilia is with Astreo S.r.l., Italy.
Lorenzo Mario Amorosa and Chiara Buratti are with the Department of Electrical, Electronics, and Information Engineering ”Guglielmo Marconi” of the University of Bologna, Italy.
## Related publications
The main reference for the simulator is the paper: "MAC and Routing Protocols Design in Multi-Hop Terahertz Networks", S. Cavallero, A. Pumilia, G. Cuozzo, L.M. Amorosa, C. Buratti, submitted to IEEE Open Journal of the Communications Society, 2025.
## License



